<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CTF Leaderboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body { background:#000 url('image.png') no-repeat center center fixed; background-size:cover; color:#0ff; font-family:"Courier New", monospace; display:flex; flex-direction:column; align-items:center; padding:30px; }
  h1,h2 { color:#f0f; }
  #nav { position:absolute; top:10px; right:20px; }
  #nav a { margin-left:20px; color:#f0f; text-decoration:none; font-weight:bold; }
  #scoreboard { list-style:none; padding:0; width:min(480px, 92vw); }
  #scoreboard li { padding:6px; border-bottom:1px solid #0ff; }
  #scoreboard li.top { color: gold; font-weight:bold; }
</style>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

const firebaseConfig={apiKey:"AIzaSyCkblbbA7iZmiGr617-KZB8Yd3H3a2Aq4M",authDomain:"ctfscoreboard-3af1b.firebaseapp.com",projectId:"ctfscoreboard-3af1b"};
const app=initializeApp(firebaseConfig);
const db=getFirestore(app);
const auth=getAuth(app);

onAuthStateChanged(auth, (u)=>{ if(!u || !u.email.endsWith("@player.local")) window.location.href="login.html"; });

window.logout = async function(){ await signOut(auth); window.location.href="login.html"; }

async function loadLeaderboard(){
  const ul=document.getElementById('scoreboard'); ul.innerHTML='';
  const snap=await getDocs(collection(db,"scores"));
  const scores={};
  snap.forEach(doc=>{ const d=doc.data(); scores[d.nickname]=(scores[d.nickname]||0)+d.points; });
  const sorted=Object.entries(scores).sort((a,b)=>b[1]-a[1]);
  sorted.forEach(([nick,pts],idx)=>{
    const li=document.createElement('li');
    li.textContent=`${idx+1}. ${nick} : ${pts} pts`;
    if(idx===0) li.classList.add('top');
    ul.appendChild(li);
  });
}

window.onload=loadLeaderboard;
</script>
</head>
<body>
<div id="nav">
  <a href="index.html">Submit Flag</a>
  <a href="user.html">Profile</a>
  <a href="#" onclick="logout()">Logout</a>
</div>
<h1>üèÜ CTF Leaderboard</h1>
<ul id="scoreboard"></ul>
</body>
</html>
